<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Arena</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
<style>
    body { 
        margin: 0; overflow: hidden; background: #050505; touch-action: none;
        background-image: radial-gradient(circle at 50% 50%, #1a1a20 0%, #000 100%);
    }

    #hud { 
        position: absolute; top: 10px; left: 2%; width: 96%; 
        display: flex; justify-content: space-between; padding: 15px; 
        background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        border-radius: 15px; backdrop-filter: blur(5px); box-sizing: border-box; z-index: 10;
    }
    .p-card { display: flex; align-items: center; gap: 10px; font-family: 'Orbitron'; color: #fff; }
    .dot { width: 10px; height: 10px; border-radius: 50%; box-shadow: 0 0 10px currentColor; }

    #status {
        position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.8); border: 1px solid #333; color: #fff;
        padding: 10px 30px; border-radius: 30px; font-family: 'Orbitron'; letter-spacing: 2px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5); z-index: 10; pointer-events: none;
    }

    canvas { display: block; width: 100%; height: 100%; }

    /* Modal */
    #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; display: none; }
    .loader { border: 5px solid #333; border-top: 5px solid #ffd700; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    h2 { color: #fff; font-family: 'Orbitron'; letter-spacing: 2px; }
</style>
</head>
<body>

<div id="hud">
    <div class="p-card" style="color: #ff3333">
        <div class="dot" style="background:#ff3333"></div>
        <span>OPP: <span id="s-opp">16</span></span>
    </div>
    <div class="p-card" style="color: #3388ff">
        <span>YOU: <span id="s-you">16</span></span>
        <div class="dot" style="background:#3388ff"></div>
    </div>
</div>

<div id="status">INITIALIZING...</div>
<canvas id="canvas"></canvas>

<div id="modal">
    <div class="loader"></div>
    <h2 id="m-msg">SEARCHING OPPONENT...</h2>
    <button onclick="location.href='home.html'" style="margin-top:20px; padding:10px 30px; background:none; border:1px solid #555; color:#fff; border-radius:20px;">CANCEL</button>
</div>

<script>
    // Copy Game Logic from previous response but Updated Draw Function
    const firebaseConfig = { apiKey: "AIzaSyC2Uxgv0vjY2G6xgQ6jAwOkKHIp8wKRFvk", authDomain: "game-ee829.firebaseapp.com", databaseURL: "https://game-ee829-default-rtdb.firebaseio.com", projectId: "game-ee829", storageBucket: "game-ee829.firebasestorage.app", messagingSenderId: "70259643410", appId: "1:70259643410:web:2539716504e7ba635434cb" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');
    const code = urlParams.get('code');
    const myPhone = localStorage.getItem('art_user_phone');
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let nodes=[], pieces=[], turn=1, myTeam=1, selected=null, validMoves=[], gameId=null, isBot=false, chainPiece=null;

    function resize() {
        const dpr = window.devicePixelRatio || 1;
        canvas.width = window.innerWidth * dpr;
        canvas.height = window.innerHeight * dpr;
        ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resize);

    // --- LOGIC (Simplified from previous response, same core logic) ---
    function init() {
        resize(); createBoard();
        if(mode==='offline') { isBot=true; document.getElementById('status').innerText="VS BOT"; }
        else if(mode==='invite') { joinPrivate(code); }
        else findMatch();
        loop();
    }

    function createBoard() {
        nodes=[]; pieces=[];
        const w=window.innerWidth, h=window.innerHeight;
        const size = Math.min(w,h)*0.9;
        const uX=size/8, uY=size/10, cx=w/2, cy=h/2;
        let id=0;
        // ... (Same Board generation as before)
        for(let r=0; r<9; r++) {
            for(let c=0; c<5; c++) {
                let v = (r==0&&c==2)||(r==1&&c>=1&&c<=3)||(r>=2&&r<=6)||(r==7&&c>=1&&c<=3)||(r==8&&c==2);
                if(v) nodes.push({x:cx+(c-2)*uX*1.3, y:cy+(r-4)*uY, r, c, id:id++, n:[]});
            }
        }
        nodes.forEach(n1=>nodes.forEach(n2=>{
            if(n1===n2)return;
            let dr=Math.abs(n1.r-n2.r), dc=Math.abs(n1.c-n2.c);
            if((dr==1&&dc==0)||(dr==0&&dc==1)||(dr==1&&dc==1)) n1.n.push(n2.id);
        }));
        nodes.forEach(n=>{
            if(n.r<4) pieces.push({id:n.id, t:0, a:1});
            if(n.r>4) pieces.push({id:n.id, t:1, a:1});
        });
    }

    // --- DRAW (PREMIUM) ---
    function draw() {
        ctx.clearRect(0,0,canvas.width/window.devicePixelRatio, canvas.height/window.devicePixelRatio);
        
        // Glow Connections
        ctx.shadowBlur = 10; ctx.shadowColor = "#ffd700";
        ctx.strokeStyle = "rgba(255, 215, 0, 0.2)"; ctx.lineWidth = 4; ctx.lineCap='round';
        ctx.beginPath();
        nodes.forEach(n => n.n.forEach(nid => {
            if(n.id < nid) { let n2=nodes[nid]; ctx.moveTo(n.x,n.y); ctx.lineTo(n2.x,n2.y); }
        }));
        ctx.stroke();
        ctx.shadowBlur=0;

        // Valid Moves
        validMoves.forEach(m => {
            let n = nodes[m.to];
            ctx.beginPath(); ctx.arc(n.x, n.y, 10, 0, 7);
            ctx.fillStyle = m.kill ? "#ff3333" : "#00ffcc";
            ctx.shadowBlur=15; ctx.shadowColor=ctx.fillStyle;
            ctx.fill(); ctx.shadowBlur=0;
        });

        // Pieces
        pieces.forEach(p => {
            if(!p.a) return;
            let n = nodes[p.id];
            let color = p.t===0 ? "#ff3333" : "#3388ff";
            
            // Selection Glow
            if(selected===p || chainPiece===p) {
                ctx.beginPath(); ctx.arc(n.x,n.y,25,0,7);
                ctx.strokeStyle="#fff"; ctx.lineWidth=2; ctx.stroke();
            }

            // 3D Gradient Bead
            let grad = ctx.createRadialGradient(n.x-5, n.y-5, 2, n.x, n.y, 18);
            grad.addColorStop(0, "#fff");
            grad.addColorStop(1, color);
            
            ctx.beginPath(); ctx.arc(n.x,n.y,18,0,7);
            ctx.fillStyle = grad;
            ctx.shadowBlur=10; ctx.shadowColor=color;
            ctx.fill(); ctx.shadowBlur=0;
        });
    }

    function loop() { requestAnimationFrame(loop); draw(); }

    // --- Input & Matchmaking Hooks (Keep simplified for display) ---
    // (Ensure you copy the Logic functions from previous response here: findMatch, handleInput, etc.)
    // I am including essential listeners for UI update:
    
    canvas.addEventListener('touchstart', e => { 
        handleInput(e.touches[0]); e.preventDefault(); 
    }, {passive:false});
    
    // Add logic functions from previous response inside this script tag...
    // For brevity in design focus, assume logic is merged.
    
    // Mock Update for UI design test
    function updateStatus() {
        let r=pieces.filter(p=>p.t===0&&p.a).length;
        let b=pieces.filter(p=>p.t===1&&p.a).length;
        document.getElementById('s-opp').innerText = r;
        document.getElementById('s-you').innerText = b;
        document.getElementById('status').innerText = (turn === myTeam) ? "YOUR TURN" : "OPPONENT TURN";
        if(chainPiece) document.getElementById('status').innerText = "CHAIN ATTACK!";
    }
    
    // Logic Imports
    // Copy the `findMatch`, `joinPrivate`, `handleInput`, `executeMove`, `checkWin` from previous response here.
    // Ensure `draw()` is not duplicated.
    
    init();
</script>
</body>
</html>
