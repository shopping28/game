<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Game</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Poppins:wght@400&display=swap" rel="stylesheet">
    <style>
        body { background: #0f0f12; color: #fff; font-family: 'Poppins', sans-serif; display: flex; flex-direction: column; align-items: center; padding-top: 20px; height: 100vh; margin:0; }
        
        .code-display { font-family: 'Orbitron'; font-size: 32px; color: #ffd700; letter-spacing: 5px; margin: 20px 0; text-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .start-btn { background: #ffd700; color: #000; padding: 10px 40px; border-radius: 30px; border: none; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; margin-bottom: 20px; }

        .friend-panel { width: 90%; max-width: 400px; background: #1e1e24; flex: 1; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .f-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #333; }
        .invite-btn { background: linear-gradient(45deg, #00c6ff, #0072ff); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-size: 12px; cursor: pointer; transition: 0.2s; }
        .invite-btn:active { transform: scale(0.95); }

        .sent { background: #333 !important; color: #aaa !important; cursor: default; }
    </style>
</head>
<body>

    <h2 style="font-family:'Orbitron'; margin-bottom:0">GAME ROOM</h2>
    <div class="code-display" id="roomCode">...</div>
    <button class="start-btn" onclick="enterGame()">ENTER LOBBY</button>

    <div class="friend-panel">
        <h4 style="margin-top:0; color:#888">INVITE ONLINE FRIENDS</h4>
        <div id="f-list">Loading friends...</div>
    </div>
    
    <div style="padding:10px; cursor:pointer; color:#555" onclick="location.href='home.html'">Cancel</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyC2Uxgv0vjY2G6xgQ6jAwOkKHIp8wKRFvk", authDomain: "game-ee829.firebaseapp.com", databaseURL: "https://game-ee829-default-rtdb.firebaseio.com", projectId: "game-ee829", storageBucket: "game-ee829.firebasestorage.app", messagingSenderId: "70259643410", appId: "1:70259643410:web:2539716504e7ba635434cb" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const code = Math.floor(1000 + Math.random() * 9000);
    document.getElementById('roomCode').innerText = code;
    
    const myPhone = localStorage.getItem('art_user_phone');
    let myName = "Unknown";

    // Get My Name
    db.ref('users/'+myPhone).once('value', s => myName = s.val().fullName);

    // Load Invite List
    db.ref('users/' + myPhone + '/friends').once('value', snap => {
        const list = document.getElementById('f-list');
        list.innerHTML = '';
        
        if(!snap.exists()) { list.innerHTML = 'No friends added.'; return; }

        snap.forEach(f => {
            const fPhone = f.key;
            db.ref('users/' + fPhone).once('value', uSnap => {
                const u = uSnap.val();
                list.innerHTML += `
                    <div class="f-item">
                        <div><b>${u.fullName}</b><br><small style="color:#aaa">${u.username}</small></div>
                        <button class="invite-btn" id="btn-${fPhone}" onclick="sendInvite('${fPhone}')">INVITE</button>
                    </div>
                `;
            });
        });
    });

    function sendInvite(friendPhone) {
        // Send Notification to Friend
        db.ref('users/' + friendPhone + '/game_invite').set({
            from: myPhone,
            fromName: myName,
            roomCode: code,
            timestamp: Date.now()
        });

        const btn = document.getElementById('btn-' + friendPhone);
        btn.innerText = "SENT";
        btn.classList.add('sent');
        btn.disabled = true;
    }

    function enterGame() {
        window.location.href = `game.html?mode=invite&code=${code}`;
    }
</script>
</body>
</html>
