<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Lobby</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; padding-top: 20px;
            font-family: 'Roboto', sans-serif;
            background-color: #deb887;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                repeating-linear-gradient(45deg, rgba(139, 69, 19, 0.05) 0, rgba(139, 69, 19, 0.05) 2px, transparent 2px, transparent 6px);
            background-size: 50px 50px, 50px 50px, 100% 100%;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; box-sizing: border-box; color: #3e2723;
        }
        
        h2 { 
            margin: 0 0 5px 0; text-shadow: 1px 1px 0 rgba(255,255,255,0.4);
            font-size: 24px; color: #3e2723;
        }

        /* Wooden Box Style */
        .wood-panel {
            background: #5d4037; /* Dark Wood */
            border: 4px solid #3e2723;
            padding: 20px; border-radius: 20px; 
            text-align: center; width: 85%; max-width: 350px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4), inset 0 2px 5px rgba(255,255,255,0.1);
            margin-bottom: 20px; color: #d7ccc8;
        }

        .label { font-size: 11px; letter-spacing: 1px; color: #bcaaa4; display: block; margin-bottom: 5px; }

        .code-display { 
            background: #3e2723; color: #fff; 
            font-size: 32px; font-weight: bold; letter-spacing: 5px; 
            margin: 10px 0 20px 0; padding: 15px; border-radius: 10px;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.5);
            font-family: monospace; border-bottom: 2px solid #5d4037;
        }

        /* Wooden Buttons */
        .btn-wood { 
            background: #8d6e63; color: #fff; border: none; padding: 12px 0; 
            border-radius: 30px; font-weight: bold; width: 100%; cursor: pointer;
            box-shadow: 0 5px 0 #5d4037; transition: 0.1s;
            border: 1px solid #795548;
        }
        .btn-wood:active { transform: translateY(5px); box-shadow: 0 0 0 #5d4037; }

        .btn-join { 
            background: #ff7043; box-shadow: 0 5px 0 #bf360c; border-color: #e64a19; 
            width: auto; padding: 0 25px;
        }
        .btn-join:active { transform: translateY(5px); box-shadow: 0 0 0 #bf360c; }

        .join-box { display: flex; gap: 10px; margin-top: 15px; }
        .join-input { 
            background: #d7ccc8; border: 2px solid #8d6e63; color: #3e2723; 
            padding: 10px; flex: 1; text-align: center; border-radius: 10px;
            font-weight: bold; font-size: 16px; outline: none;
            box-shadow: inset 0 3px 5px rgba(0,0,0,0.2);
        }

        /* Friend List Panel */
        .friend-panel { 
            flex: 1; width: 100%; background: #fff3e0; 
            border-top: 5px solid #5d4037;
            border-radius: 20px 20px 0 0; 
            padding: 25px; box-sizing: border-box; overflow-y: auto;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
        }

        .f-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 15px; margin-bottom: 10px; 
            background: #ffe0b2; border-radius: 12px; 
            border-bottom: 2px solid #e65100;
        }

        .invite-btn { 
            background: #2e7d32; color: #fff; border: none;
            padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer;
            font-size: 11px; box-shadow: 0 3px 0 #1b5e20;
        }
        .invite-btn:active { transform: translateY(3px); box-shadow: none; }
        
        .sent { background: #555 !important; box-shadow: none !important; color: #ccc !important; cursor: default; }

        .link-back { color: #5d4037; text-decoration: underline; cursor: pointer; margin-top: 10px; display: block; text-align: center; }
    </style>
</head>
<body>

    <h2>GAME LOBBY</h2>
    
    <div class="wood-panel">
        <span class="label">YOUR ROOM CODE</span>
        <div class="code-display" id="roomCode">...</div>
        <button class="btn-wood" onclick="enterGame()">ENTER ROOM</button>
        
        <div class="join-box">
            <input type="number" id="joinInput" class="join-input" placeholder="Join Code">
            <button class="btn-wood btn-join" onclick="joinGame()">GO</button>
        </div>
    </div>

    <div class="friend-panel">
        <span style="display:block; margin-bottom:15px; color:#5d4037; font-weight:bold; font-size:14px; text-align:center;">ONLINE FRIENDS</span>
        <div id="f-list" style="text-align:center; color:#795548;">Loading friends...</div>
        <span class="link-back" onclick="location.href='home.html'">Return Home</span>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyC2Uxgv0vjY2G6xgQ6jAwOkKHIp8wKRFvk", authDomain: "game-ee829.firebaseapp.com", databaseURL: "https://game-ee829-default-rtdb.firebaseio.com", projectId: "game-ee829", storageBucket: "game-ee829.firebasestorage.app", messagingSenderId: "70259643410", appId: "1:70259643410:web:2539716504e7ba635434cb" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Generate Code
    const code = Math.floor(1000 + Math.random() * 9000);
    document.getElementById('roomCode').innerText = code;
    
    const myPhone = localStorage.getItem('art_user_phone');
    let myName = "Unknown";
    db.ref('users/'+myPhone).once('value', s => myName = s.val().fullName);

    // Load Friends
    db.ref('users/' + myPhone + '/friends').once('value', snap => {
        const list = document.getElementById('f-list');
        list.innerHTML = '';
        if(!snap.exists()) { list.innerHTML = 'No friends added yet.'; return; }

        snap.forEach(f => {
            const fPhone = f.key;
            db.ref('users/' + fPhone).once('value', uSnap => {
                const u = uSnap.val();
                list.innerHTML += `
                    <div class="f-item">
                        <div>
                            <b style="color:#bf360c; font-size:14px;">${u.fullName}</b><br>
                            <span style="font-size:11px; color:#6d4c41">${u.username}</span>
                        </div>
                        <button class="invite-btn" id="btn-${fPhone}" onclick="sendInvite('${fPhone}')">INVITE</button>
                    </div>
                `;
            });
        });
    });

    function sendInvite(friendPhone) {
        db.ref('users/' + friendPhone + '/game_invite').set({
            from: myPhone, fromName: myName, roomCode: code, timestamp: Date.now()
        });
        const btn = document.getElementById('btn-' + friendPhone);
        btn.innerText = "SENT"; btn.classList.add('sent'); btn.disabled = true;
    }

    function enterGame() {
        window.location.href = `game.html?mode=invite&code=${code}`;
    }

    function joinGame() {
        const c = document.getElementById('joinInput').value;
        if(c) window.location.href = `game.html?mode=invite&code=${c}`;
    }
</script>
</body>
</html>
